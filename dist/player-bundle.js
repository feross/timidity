function t(t,e,r,n,o,i,s){try{var a=t[i](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,o)}function e(e){return function(){var r=this,n=arguments;return new Promise((function(o,i){var s=e.apply(r,n);function a(e){t(s,o,i,a,u,"next",e)}function u(e){t(s,o,i,a,u,"throw",e)}a(void 0)}))}}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var n,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(t){var e=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof y?e:y,i=Object.create(o.prototype),s=new A(n||[]);return i._invoke=function(t,e,r){var n=l;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===v){if("throw"===o)throw i;return N()}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var a=E(s,r);if(a){if(a===d)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=h(t,e,r);if("normal"===u.type){if(n=r.done?v:f,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=v,r.method="throw",r.arg=u.arg)}}}(t,r,s),i}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l="suspendedStart",f="suspendedYield",p="executing",v="completed",d={};function y(){}function m(){}function g(){}var w={};w[i]=function(){return this};var x=Object.getPrototypeOf,_=x&&x(x(O([])));_&&_!==r&&n.call(_,i)&&(w=_);var b=g.prototype=y.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,s,a){var u=h(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,a)}))}a(u.arg)}var o;this._invoke=function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}}function E(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var o=h(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,d;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function O(t){if(t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}return{next:N}}function N(){return{value:e,done:!0}}return m.prototype=b.constructor=g,g.constructor=m,m.displayName=u(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},L(k.prototype),k.prototype[s]=function(){return this},t.AsyncIterator=k,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var s=new k(c(e,r,n,o),i);return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},L(b),u(b,a,"Generator"),b[i]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return a.type="throw",a.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})(n={exports:{}},n.exports);var i=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t},s=Object.prototype.hasOwnProperty;function a(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function u(t){try{return encodeURIComponent(t)}catch(t){return null}}var c={stringify:function(t,e){e=e||"";var r,n,o=[];for(n in"string"!=typeof e&&(e="?"),t)if(s.call(t,n)){if((r=t[n])||null!=r&&!isNaN(r)||(r=""),n=u(n),r=u(r),null===n||null===r)continue;o.push(n+"="+r)}return o.length?e+o.join("&"):""},parse:function(t){for(var e,r=/([^=?#&]+)=?([^&]*)/g,n={};e=r.exec(t);){var o=a(e[1]),i=a(e[2]);null===o||null===i||o in n||(n[o]=i)}return n}},h=/^[A-Za-z][A-Za-z0-9+-.]*:[\\/]+/,l=/^([a-z][a-z0-9.+-]*:)?([\\/]{1,})?([\S\s]*)/i,f=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function p(t){return(t||"").toString().replace(f,"")}var v=[["#","hash"],["?","query"],function(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};function y(t){var e,r=("undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{}).location||{},n={},i=typeof(t=t||r);if("blob:"===t.protocol)n=new g(unescape(t.pathname),{});else if("string"===i)for(e in n=new g(t,{}),d)delete n[e];else if("object"===i){for(e in t)e in d||(n[e]=t[e]);void 0===n.slashes&&(n.slashes=h.test(t.href))}return n}function m(t){t=p(t);var e=l.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!(e[2]&&e[2].length>=2),rest:e[2]&&1===e[2].length?"/"+e[3]:e[3]}}function g(t,e,r){if(t=p(t),!(this instanceof g))return new g(t,e,r);var n,o,s,a,u,h,l=v.slice(),f=typeof e,d=this,w=0;for("object"!==f&&"string"!==f&&(r=e,e=null),r&&"function"!=typeof r&&(r=c.parse),e=y(e),n=!(o=m(t||"")).protocol&&!o.slashes,d.slashes=o.slashes||n&&e.slashes,d.protocol=o.protocol||e.protocol||"",t=o.rest,o.slashes||(l[3]=[/(.*)/,"pathname"]);w<l.length;w++)"function"!=typeof(a=l[w])?(s=a[0],h=a[1],s!=s?d[h]=t:"string"==typeof s?~(u=t.indexOf(s))&&("number"==typeof a[2]?(d[h]=t.slice(0,u),t=t.slice(u+a[2])):(d[h]=t.slice(u),t=t.slice(0,u))):(u=s.exec(t))&&(d[h]=u[1],t=t.slice(0,u.index)),d[h]=d[h]||n&&a[3]&&e[h]||"",a[4]&&(d[h]=d[h].toLowerCase())):t=a(t);r&&(d.query=r(d.query)),n&&e.slashes&&"/"!==d.pathname.charAt(0)&&(""!==d.pathname||""!==e.pathname)&&(d.pathname=function(t,e){if(""===t)return e;for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),n=r.length,o=r[n-1],i=!1,s=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),s++):s&&(0===n&&(i=!0),r.splice(n,1),s--);return i&&r.unshift(""),"."!==o&&".."!==o||r.push(""),r.join("/")}(d.pathname,e.pathname)),"/"!==d.pathname.charAt(0)&&d.hostname&&(d.pathname="/"+d.pathname),i(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.split(":"),d.username=a[0]||"",d.password=a[1]||""),d.origin=d.protocol&&d.host&&"file:"!==d.protocol?d.protocol+"//"+d.host:"null",d.href=d.toString()}g.prototype={set:function(t,e,r){var n=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(r||c.parse)(e)),n[t]=e;break;case"port":n[t]=e,i(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[t]="");break;case"hostname":n[t]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[t]=e,/:\d+$/.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(e){var o="pathname"===t?"/":"#";n[t]=e.charAt(0)!==o?o+e:e}else n[t]=e;break;default:n[t]=e}for(var s=0;s<v.length;s++){var a=v[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.origin=n.protocol&&n.host&&"file:"!==n.protocol?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(t){t&&"function"==typeof t||(t=c.stringify);var e,r=this,n=r.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var o=n+(r.slashes?"//":"");return r.username&&(o+=r.username,r.password&&(o+=":"+r.password),o+="@"),o+=r.host+r.pathname,(e="object"==typeof r.query?t(r.query):r.query)&&(o+="?"!==e.charAt(0)?"?"+e:e),r.hash&&(o+=r.hash),o}},g.extractProtocol=m,g.location=y,g.trimLeft=p,g.qs=c;var w=g;function x(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var _=x;function b(t){return"function"==typeof t}function L(t){return"object"==typeof t&&null!==t}function k(t){return void 0===t}function E(t){return new w(t)}x.EventEmitter=x,x.prototype._events=void 0,x.prototype._maxListeners=void 0,x.defaultMaxListeners=10,x.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},x.prototype.emit=function(t){var e,r,n,o,i,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||L(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var a=new Error('Uncaught, unspecified "error" event. ('+e+")");throw a.context=e,a}if(k(r=this._events[t]))return!1;if(b(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(L(r))for(o=Array.prototype.slice.call(arguments,1),n=(s=r.slice()).length,i=0;i<n;i++)s[i].apply(this,o);return!0},x.prototype.addListener=function(t,e){var r;if(!b(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,b(e.listener)?e.listener:e),this._events[t]?L(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,L(this._events[t])&&!this._events[t].warned&&(r=k(this._maxListeners)?x.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},x.prototype.on=x.prototype.addListener,x.prototype.once=function(t,e){if(!b(e))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}return n.listener=e,this.on(t,n),this},x.prototype.removeListener=function(t,e){var r,n,o,i;if(!b(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(r=this._events[t]).length,n=-1,r===e||b(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(L(r)){for(i=o;i-- >0;)if(r[i]===e||r[i].listener&&r[i].listener===e){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},x.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(b(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},x.prototype.listeners=function(t){return this._events&&this._events[t]?b(this._events[t])?[this._events[t]]:this._events[t].slice():[]},x.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(b(e))return 1;if(e)return e.length}return 0},x.listenerCount=function(t,e){return t.listenerCount(e)};var R=function(t){var n,o;function i(e,r,n){var o;return(o=t.call(this)||this)._worklet=e,o._baseURL=n,o._worklet.port.onmessage=o._handleMessage.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(o)),o.context=r,o._worklet.connect(r.destination),o}o=t,(n=i).prototype=Object.create(o.prototype),n.prototype.constructor=n,r(n,o);var s=i.prototype;return s._handleMessage=function(){var t=e(regeneratorRuntime.mark((function t(e){var r,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("missingInstruments"!==e.data.type){t.next=15;break}return r=[],t.prev=2,t.next=5,Promise.all(e.data.instruments.map((function(t){return n.fetchInstrument(t)})));case 5:r=t.sent,t.next=12;break;case 8:t.prev=8,t.t0=t.catch(2),console.log("Error loading instrument patch files"),console.log(t.t0);case 12:this._worklet.port.postMessage({type:"instPayload",buffs:r}),t.next=16;break;case 15:"loaded"===e.data&&this.emit("song-loaded");case 16:case"end":return t.stop()}}),t,this,[[2,8]])})));return function(e){return t.apply(this,arguments)}}(),s.play=function(){this.context.resume(),this._worklet.port.postMessage("play")},s.pause=function(){this._worklet.port.postMessage("pause")},s.seek=function(t){this._worklet.port.postMessage({type:"seek",sec:t})},s.load=function(){var t=e(regeneratorRuntime.mark((function t(e){var r,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(e);case 2:return r=t.sent,this._worklet.port.postMessage({type:"loadMIDI",midiBuff:r}),t.next=6,new Promise((function(t,e){n.on("song-loaded",(function(){return t()})),setTimeout((function(){return e("timeout on loading midi song instruments, 5000")}),5e3)}));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.createMIDIPlayer=function(){var t=e(regeneratorRuntime.mark((function t(e,r){var n,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e="/gravis.cfg"),void 0===r&&(r=new AudioContext),t.prev=2,t.next=5,r.audioWorklet.addModule("/worklet-bundle.js");case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),console.log(t.t0);case 10:return t.next=12,O(e);case 12:return n=t.sent,0===(o=e.substring(0,e.lastIndexOf("/")+1)).length&&(o="/"),s=new AudioWorkletNode(r,"midiplayer",{outputChannelCount:[2],processorOptions:{baseURL:o,timidityCfg:n}}),t.abrupt("return",new i(s,r,o));case 17:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e,r){return t.apply(this,arguments)}}(),s.fetchInstrument=function(){var t=e(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._baseURL+e,"pat"!==/(?:\.([^.]+))?$/.exec(e)&&(r=this._baseURL+e+".pat"),t.t0=e,t.next=6,j(r);case 6:return t.t1=t.sent,t.abrupt("return",{instrumentName:t.t0,instrumentBuff:t.t1});case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i}(_.EventEmitter);function j(t){return A.apply(this,arguments)}function A(){return(A=e(regeneratorRuntime.mark((function t(e){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C(e);case 2:return r=t.sent,t.next=5,r.arrayBuffer();case 5:return n=t.sent,o=new Uint8Array(n),t.abrupt("return",o);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t){return N.apply(this,arguments)}function N(){return(N=e(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C(e);case 2:return r=t.sent,t.next=5,r.text();case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(t){return P.apply(this,arguments)}function P(){return(P=e(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={mode:"cors",credentials:"same-origin"},t.next=3,window.fetch(e,r);case 3:if(200===(n=t.sent).status){t.next=6;break}throw new Error("Could not load "+e);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}export default R;export{E as createURL,O as fetchText};
